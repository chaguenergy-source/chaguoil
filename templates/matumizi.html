{% extends 'index.html' %}

{% load humanize %}

{% load static %}
{% block page_content %}

<div class="head-title">
    <div class="left">
        
        {% include 'heading.html' %}
        <ul class="breadcrumb">
            <li>
                <a href="#">Dashboard</a>
            </li>
            <li>
               <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
                 <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </li>
            <li>
                <a class="active" href="#"> {% if useri.langSet == 0 %}Kurekodi Matumizi{% else %} Record Expenses{% endif %}</a>
            </li>
        </ul>
    </div>
</div>


    <div class="table-data">
        <div class="order">
                   {% include 'headingPayments.html' %}   
          <div class="head">
    
        <div class=" my-4 card  overflow-hidden" style="width: 100%;" >
        
        <!-- Header -->
        <div class="header-section card-header p-4 rounded-top">
            <h3 class="h3 fw-bold mb-1"> 
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.6em" height="1.6em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" class="feather icon-svg feather-wine-outline">
                        <!-- Goblet pana na curve chini laini (cubic bezier) -->
                        <!-- M6 4h12 = mstari wa juu, C 18 10 16 12 12 12 = curve ya kushoto, C 8 12 6 10 6 4 = curve ya kulia -->
                        <path d="M6 4h12C18 10 16 12 12 12C8 12 6 10 6 4z"></path>
                        <!-- Shina (Stem) -->
                        <path d="M12 12v7"></path>
                        <!-- Base ya chini (Foot) -->
                        <path d="M9 19h6"></path>
            </svg>
                {% if useri.langSet == 0 %} Kurekodi Matumizi ya Kituo {% else %} Station Expenses Entry {% endif %}
            </h3>
        </div>
        
        <!-- Expense Form -->
        <div class="card-body p-4">
            <form id="expenseForm">

                <!-- 1. GLOBAL SOURCE TYPE SELECTION -->
                <div class="row mb-4 fixed-source-info">
                    <div class="col-12 col-md-6">
                        <label for="globalSourceType" class="form-label text-dark brown"> {% if useri.langSet == 0 %} Chagua Chanzo cha Matumizi {% else %} Select Expense Source {% endif %} <span class="text-danger">*</span></label>
                        <select id="globalSourceType" onchange="initializeForm(this.value)" class="form-select form-control form-select-lg" required>
                            <option value="" disabled selected>--- {% if useri.langSet == 0 %} Chagua Chanzo --- {% else %} Select Source --- {% endif %}</option>
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                </div>

                <!-- 2. EXPENSE ROWS TABLE CONTAINER (Dynamically Populated) -->
                 <!-- 2. EXPENSE ROWS TABLE CONTAINER (Dynamically Populated) -->
                <div id="expenseTableContainer" class="table-responsive mt-4 hidden">
                    <table class="table table-bordered table-striped" id="expenseTable">
                        <thead>
                            <!-- Headers loaded dynamically by initializeForm() -->
                        </thead>
                        <tbody id="expenseRowsContainer">
                            <!-- Rows loaded dynamically by addRow() -->
                        </tbody>
                    </table>
                </div>

                <div id="adjust_panel_forOptions" class="hidden" >
                        <div class="text-right"  >
                            <button type="button" id="addRowBtn" class="btn btn-info smallFont btn-sm shadow-sm" onclick="addRow()" >
                                <svg class="me-2" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                {% if useri.langSet == 0 %} Ongeza  {% else %} Add  {% endif %}
                            </button>
                        </div>

                        <!-- DISPLAY TOTAL EXPENSES -->
                        <div id="totalDisplay" class="alert alert-info mt-4 " role="alert">
                            ** {% if useri.langSet == 0 %} Jumla ya Matumizi ya Pesa {% else %} Total Expenses (Monetary) {% endif %}:** {{currencii}} <span id="totalAmount" class="fw-bold">0.00</span>
                        </div>

                        <div class="mt-4 text-right">
                            <button type="submit" id="submitBtn" class="btn btn-primary btn-lg shadow-sm" disabled>
                                {% if useri.langSet == 0 %} Tuma Matumizi Yote {% else %} Submit All Expenses {% endif %}
                            </button>
                        </div>
                </div>
                
            </form>
            
            <!-- Output Area for Simulation -->
            <div id="output" class="mt-5 p-3 bg-light rounded hidden" style="margin-top:-100px" >
                <h3 class="h5 text-dark mb-3">Submitted Data (Simulation)</h3>
                <pre id="outputData" class="small"></pre>
            </div>

        </div>
    </div>

    <!-- MODAL FOR NEW EXPENSE GROUP -->
    <div class="modal fade" id="newExpenseGroupModal" tabindex="-1" aria-labelledby="newExpenseGroupModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-3 shadow-lg">
                <div class="modal-header bg-info text-white rounded-top">
                    <h5 class="modal-title" id="newExpenseGroupModalLabel">Ongeza Kundi Jipya la Matumizi</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newGroupForm">
                        <div class="mb-3">
                            <label for="newGroupNameInput" class="form-label">Jina la Kundi la Matumizi (Expense Group Name)</label>
                            <input type="text" class="form-control" id="newGroupNameInput" required placeholder="Mfano: Cleaning Supplies">
                        </div>
                        <div class="mb-3">
                            <label for="newExpenseTypeSelect" class="form-label">Aina ya Matumizi (Expense Type)</label>
                            <select class="form-select" id="newExpenseTypeSelect" required>
                                <option value="CASH">Cash Amount (Kutumia pesa)</option>
                                <option value="FUEL">Fuel Consumption (Matumizi ya Lita)</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveNewExpenseGroup()">Save New Group</button>
                </div>
            </div>
        </div>
    </div>

    {% endblock %}
          
     {% block additional_css %}
          <link rel="stylesheet" href="{% static 'css/rekodiMatumizi.css' %}">
     {% endblock %}

    {% block additionaljs %}
          <script src="{% static 'js/rekodiMatumizi.js' %}"></script>
    {% endblock %}

{% block payaccount %} active  {% endblock %}
