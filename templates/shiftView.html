{% extends 'index.html' %}
{% load humanize %}
{% block page_content %}

<div class="head-title pb-md-5">
    <div class="left">
        
        {% include 'heading.html' %}
        <ul class="breadcrumb">
            <li>
                <a href="#">Dashboard</a>
            </li>
            <li>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
                    <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
            </li>
            <li>
                <a class="active" href="#"> {% if useri.langSet == 0 %}Notisi ya Mauzo ya Mafuta{% else %} Fuel Sales Note{% endif %}</a>
            </li>
        </ul>
    </div>
    
   


</div>

<div class="table-data" id="invoice_wrapper" >
    <div class="order">

    {% include 'headingShifts.html' %} 

    <div class="row ">
        <div class="col-md-4  border-right" >
            <header class="border-bottom  ">
                <div class="row classic_div py-2">

                <div class="col-12">
                   <form action="{% url 'viewShift' %}" method="get">
                    <div class="input-group"> 
                      <div class="input-group-prepend border">
                        <button type="button" onclick="$('.listin').toggle(400)" class="d-flex d-md-none btn btn-light btn-sm  " >
                          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>

                            
                            </svg>
                        </button>
                       
                     </div> 
                       
                              <input type="text" name="code" id="code" placeholder=" {% if useri.langSet == 0 %}  Andika no ya Mauzo {% else %} write Sales no.. {% endif %}" class="form-control smallFont">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-secondary smallerFont btn-sm pt-2">
                               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                   <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                 </svg>
                            </button>
                        </div>  
                       
                       
                    </div>
              </form>

                </div>


                </div>

                
            </header>

            <div class="listin" style="height: 100vh;">
                <ul class="list-unstyled listin" style='overflow-y:auto;height:63vh;overflow-x:hidden' >
                   {% for invo in tr %}
   
                   {% if invo.id == trf.id %}
   
                   <li class="p-2  border-bottom" style="border-left:4px solid rgb(0, 106, 228) ;background:var(--light-blue)" >
                    {% else %}   
                   <li class="p-2  border-bottom" >
                    {% endif %}
                       
   
                           <a  class="row smallerFont fontColor text-decoration-none"  href="{% url 'viewShift' %}?i={{invo.id}} " >
                               <div class="col-12">
                                     <span class="smallFont text-primary" > SHF-{{invo.code}}</span>     
                                     {% if general %}|  {{invo.record_by.Interprise.name}} {% endif %}
                               </div>
                              
                              
   
                               <div class="col-12 latoFont smallFont  pt-0">
                                 <span class="bluePrint btn btn-default btn-sm smallFont px-0 latoFont"> {{invo.by.user.first_name | title}}  {{invo.by.user.last_name | title}}</span> |
                              
                                <script>
                                     document.write(moment('{{invo.From | date:"r"  }}').format('DD/MM/YYYY  HH:mm')) 
                                </script>
                                -
                                {% if invo.To %}
                                <script>
                                     document.write(moment('{{invo.To | date:"r"  }}').format('DD/MM/YYYY  HH:mm')) 
                                </script>
                                {% else %}
                                   {% if useri.langSet == 0 %} Sasa {% else %} Now {% endif %}
                                {% endif %}
                              
                                       
                               </div>
   
                       
                             </a>
                       
                   </li>
   
                   {% endfor %}
               </ul>
   
               <div>
              
                   {% if tr.has_previous %}
                     <a href="{% url 'viewShift' %}?page=1&i={{trf.id}}" type="button"  class="btn btn-default border0">
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-bar-left" viewBox="0 0 16 16">
                         <path fill-rule="evenodd" d="M11.854 3.646a.5.5 0 0 1 0 .708L8.207 8l3.647 3.646a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 0 1 .708 0zM4.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 1 0v-13a.5.5 0 0 0-.5-.5z"/>
                       </svg>
                       </a>
                 
                       <a href="{% url 'viewShift' %}?page={{tr.previous_page_number}}&i={{trf.id}}" type="button"  class="btn btn-default  border0">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                           <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                         </svg>
                       </a>
                     {% endif %}
                 
                   {% if tr.has_next %}
                       <a href="{% url 'viewShift' %}?page={{tr.next_page_number}}&i={{trf.id}}" type="button" class="btn btn-default border0">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
                           <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                         </svg>
                       </a>
                 
                       <a href="{% url 'viewShift' %}?page={{pages}}&i={{trf.id}}" type="button"  class="btn btn-default border0" >
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-bar-right" viewBox="0 0 16 16">
                           <path fill-rule="evenodd" d="M4.146 3.646a.5.5 0 0 0 0 .708L7.793 8l-3.647 3.646a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708 0zM11.5 1a.5.5 0 0 1 .5.5v13a.5.5 0 0 1-1 0v-13a.5.5 0 0 1 .5-.5z"/>
                         </svg>
                       </a>
                 {% endif %}
                       <label for="">
                        
                         {% if useri.langSet == 0 %} Ukurasa wa {{p_num}} kati ya {{pages}} {% else %} page {{p_num}} of {{pages}} {% endif %}
                 
                       </label>
               </div>             
               </div> 
        </div>
        <div class="col-md-8"  >
            
            <div  class="table-responsive pt-3 px-md-2 " id="invo_box" >

                <div class="classic_div mt-sm-2 pt-3 pb-2 px-3 the_invo_page" id="the_invo_page" >
                    <h5 class="text-secondary mt-1 pb-3  border-bottom font-weight-bold">
                        {% if useri.langSet == 0 %}NOTISI YA ZAMU KWENYE PAMPU{% else %}PUMP SHIFT NOTE{% endif %}
                     </h5>

                      <div class="row mt-3">

                    

                         <div class="col-3">
                            {% if useri.langSet == 0 %}Kituo {% else %}Station{% endif %}
                         </div>
                         <div class="col-9">
                           
                               {{trf.record_by.Interprise.name|title}}  
                            

                        </div>



                         <div class="col-3">
                            {% if useri.langSet == 0 %}Zamu {% else %}Shift{% endif %}#
                         </div>
                         <div class="col-9 text-primary ">
                            SHF-{{trf.code}}
                         </div>
                         <div class="col-3">
                            {% if useri.langSet == 0 %}Mpango Zamu {% else %}Shift Session{% endif %}
                         </div>
                         <div class="col-9 text-primary ">
                            <a href="/salepurchase/SessionView?i={{trf.session.id}}">
                                <u>{{trf.session.session.name}}</u> 
                             </a>
                         </div>

                         

                         <div class="col-3">
                             {% if useri.langSet == 0 %}Kuanzia {% else %}From{% endif %}
                         </div>
                         <div class="col-9">
                                 <script>
                                    document.write(moment('{{trf.From | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                </script>     
                         </div>

                         <div class="col-3">
                            {% if useri.langSet == 0 %}Hadi {% else %}To{% endif %}
                         </div>
                         <div class="col-9">
                              {% if trf.To %}
                                <script>
                                    document.write(moment('{{trf.To | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                </script>
                              {% else %}
                                  {% if useri.langSet == 0 %}Sasa {% else %}Now{% endif %}
          
                              {% endif %}
                          </div>
                         <div class="col-3">
                            {% if useri.langSet == 0 %}Mhusika {% else %}Incharge{% endif %}
                         </div>
                         <div class="col-9 ">
                               <span class="bluePrint" > {{trf.by.user.first_name | title}} {{trf.by.user.last_name| title}}</span>  ({{trf.by.cheo}})
                          </div>
                         <div class="col-3">
                            {% if useri.langSet == 0 %}Imerekodiwa na {% else %}Recorded By{% endif %}
                         </div>
                         <div class="col-9 ">
                               <span class="bluePrint" > {{trf.record_by.user.user.first_name | title}} {{trf.record_by.user.user.last_name| title}}</span>  ({{trf.record_by.user.cheo}})
                          </div>


                     </div>

                     <hr>
          

                     <h6>
                        <strong> {% if useri.langSet == 0 %}Pampu alizosimamia {% else %} Pumps Assigned{% endif %} </strong> 

                    </h6>
                            {% for f in fshp %}
                            <div class="brown mt-3 weight500 smallFont">
                                
                                {% if useri.langSet == 0 %}Pampu za <u>{{f.f.Fuel.name}}</u> 
                                {% else %}
                                    <u>{{f.f.Fuel.name}}</u> Pumps  
                                {% endif %}
                            </div>
            
                            <div class="classic_div mx-md-3 table-sm-responsive " >
                                
                                <div class="row p-0 classic_div border" style="min-width: 700px;" >
                                    <!-- <div class="col-1 border">#</div> -->
                                    <div class="col-2 col-md-3 mx-0 smallFont weight500 border">
                                        <th>{% if useri.langSet == 0 %}Dispensa {% else %} Dispanser {% endif %}</th>
                                    </div>
            
                                    <div class="col-10 col-md-9 mx-0 smallFont weight500 row p-0 border">
                                        <div class="col-2 mx-0">
                                            {% if useri.langSet == 0 %}Pampu  {% else %} Pumps  {% endif %}
                                        </div>
            
                                        <div class="col-2 smallFont weight500">
                                            {% if useri.langSet == 0 %}Kufungua  {% else %} Opening  {% endif %}
                                        </div>
                                        <div class="col-2 mx-0 smallFont weight500">
                                            {% if useri.langSet == 0 %}Kufunga {% else %}Closing  {% endif %}
            
                                        </div>
            
                                        <div class="col-2 mx-0 smallFont weight500">
                                            {% if useri.langSet == 0 %}Bei {% else %}Price  {% endif %}/<span class="text-primary">LTR</span>
                                        </div>      
            
                                        <div class="col-2 mx-0 smallFont weight500">
                                            {% if useri.langSet == 0 %}Flow {% else %}Flow  {% endif %} <span class="text-primary">LTRS</span>
            
                                        </div>
            
                                        <div class="col-2 mx-0 smallFont weight500">
                                            {% if useri.langSet == 0 %}Kiasi {% else %}Amount  {% endif %} <span class="text-primary">({{currencii}})</span>
            
                                        </div>
                                    </div>
            
                                    
                                    {% for  sp in spancer_shp %}
                                                    
                                    {% if sp.pump.tank.fuel.id == f.f.pump.tank.fuel.id %} 
                                    <!-- <div class="col-1 border">{{forloop.counter}}</div> -->
                                    <div class="col-2 col-md-3 weight600 border mx-0">
                                        {{sp.pump.station.name}}
                                    </div>
                                    <div class="col-10 smallFont col-md-9 p-0 border mx-0 row">
                                        {% for s in shpmp %}
                                            {% if sp.pump.station == s.pump.station %}  
                                            <div class="col-2 mx-0 weight600">{{s.pump.name}}</div>
                                            <div  class="col-2 "  >{{s.initial|floatformat:'-2'|intcomma}}</div>
                                            <div class="col-2">{{s.final|floatformat:'-2'|intcomma}}</div>
                                           
                                            <div class="col-2 mx-0">
                                                {{s.price|floatformat:'-2'|intcomma}}
                                            </div>
            
                                             <div class="col-2 tot_pump_liter{{s.id}}">{{s.qty|floatformat:'-2'|intcomma}}</div>
                                         
                                             <div class="col-2 tot_pump_Amount{{s.id}}">{{s.amount|floatformat:'-2'|intcomma}}</div>    
                                            {% endif %}
                                        {% endfor %}
                                    </div>
            
                                    {% endif %}
                                    {% endfor %}
            
                                    <div class="col-md-3 col-2 border mx-0 weight600">
                                        {% if useri.langSet == 0 %}Jumla {% else %}Total  {% endif %}
                                    </div>
                                    <div class="col-md-9 col-10 weight600 mx-0 row border">
                                        <div class="col-2"></div>
                                        <div class="col-2"></div>
                                        <div class="col-2"></div>
                                        <div class="col-2"></div>  
                                        <div class="col-2 ">{{f.totQ|floatformat:'-2'|intcomma}}</div>
                                        <div class="col-2 ">{{f.totA|floatformat:'-2'|intcomma}}</div>
                                    </div>
                                </div>
                           </div>
            
            
                            {% endfor %}
                        
                        <div id="Shiftdetails"   >
              
            
                          {% if sale %}
                           
                         <div class="mt-4 table-responsive">
                            <strong>{% if useri.langSet == 0 %}Mauzo Wateja Maalum{% else %}Credit Order Sales {% endif %}</strong>
                            <table class="table table-bordered smallFont table-sm">
                                <thead>
                                    <tr class="smallFont" >
                                        <th>#</th>
                                        <th>{% if useri.langSet == 0 %}MudaTarehe{% else %}DateTime{% endif %}</th>

                                        <th>{% if useri.langSet == 0 %}Ankara{% else %} Invoice{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Pampu{% else %} Pampu{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Mafuta{% else %} Fuel{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Mteja{% else %} Customer{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Bei{% else %} Price{% endif %} <span class="text-primary">(TZS)</span> </th>

                                        <th>{% if useri.langSet == 0 %}Kiasi{% else %} Qty{% endif %} <span class="text-primary">Liters</span> </th>
                                        <th>{% if useri.langSet == 0 %}Jumla{% else %}Total{% endif %} <span class="text-primary">(TZS)</span> </th>
                                        <!-- <th>{% if useri.langSet == 0 %}Malipo{% else %}Paid{% endif %} <span class="text-primary">(TZS)</span> </th> -->
                                    </tr>
                                </thead>
                        
                                    <tbody>
                                        {% for s in sale %}
                                        <tr>
                                            <td>{{forloop.counter}}</td>
                                            <td>
                                                <script>
                                                    document.write(moment('{{s.sale.date | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                                </script>
                                            </td>
                                            <td><a href="/salepurchase/viewFuelSales?i={{s.sale.id}}">INVO-{{s.sale.code}}</a></td>

                                            <td class="bluePrint" >{{s.shift.pump.station.name}} {{s.shift.pump.name}}</td>
                                            <td class="brown" >{{s.shift.Fuel.name}}</td>

                                            <td>{{s.sale.customer.jina | title}}</td>
                                            <td>{{s.sa_price|floatformat:'-2'|intcomma}}</td>
                                            <td>{{s.qty_sold|floatformat:'-2'|intcomma}}</td>
                                            
                                            <td>{{s.amount|floatformat:'-2'|intcomma}}</td>
                                            
                                        </tr>

                                        {% endfor %}

                                        <tr class="weight600 smallFont" >
                                            <td colspan="7" > {% if useri.langSet == 0 %}Jumla{% else %}Total{% endif %} </td>
                                            <td>{{exclude.sale | floatformat:'-2'  | intcomma}}</td>
                                          
                                            <td>{{exclude.saleA | floatformat:'-2'  | intcomma}}</td>
                                        
                                        </tr>
                                    
                                    </tbody>
                                </table>


                        </div>
            
                
            
                         {% endif %}
            
                         {% if trd %}
                           <hr>
                        <div class="table-responsive">
                            <strong>{% if useri.langSet == 0 %}Kuhamisha Mafuta{% else %}Transfered Fuel {% endif %}</strong>
                            <table class="table table-bordered smallFont table-sm">
                                <thead>
                                    <tr class="smallFont" >
                                        <th>#</th>
                                        <th>{% if useri.langSet == 0 %}MudaTarehe{% else %}DateTime{% endif %}</th>

                                        <th>{% if useri.langSet == 0 %}Kuhamisha{% else %} Transfer {% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Pampu{% else %} Pump {% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Mafuta{% else %} Fuel {% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Kwenda{% else %} To{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Bei{% else %} Price{% endif %}/<span class="text-primary">LTRS</span> </th>
                                        <th>{% if useri.langSet == 0 %}Kiasi{% else %} Qty{% endif %} <span class="text-primary">LTRS</span> </th>
                                        
                                        <th>{% if useri.langSet == 0 %}Thamani{% else %} Worth{% endif %} <span class="text-primary">{{currencii}}</span> </th>
                                        
                                        </tr>
                                </thead>
                        
                                    <tbody>
                                        {% for s in trd %}
                                        <tr>
                                            <td>{{forloop.counter}}</td>
                                            <td>
                                                <script>
                                                    document.write(moment('{{s.transfer.date | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                                </script>
                                            </td>
                                            <td><a href="/salepurchase/viewTransfer?i={{s.transfer.id}}">TR-{{s.transfer.code}}</a></td>
                                            
                                            <td class="bluePrint" >{{s.shift.pump.station.name}} {{s.shift.pump.name}}</td>

                                            <td class="brown" >{{s.shift.Fuel.name}}</td>

                                            <td class="bluePrint" >{{s.to.name | title}}</td>
                                           <td>{{s.saprice|floatformat:'-2'|intcomma}}</td>
                                            <td>{{s.qty|floatformat:'-2'|intcomma}}</td>
                                            

                                            <td>
                                                <script>
                                                    var the_q =Number('{{s.qty}}'),
                                                        the_pr =Number('{{s.saprice}}'),
                                                        the_tot = Number(the_q*the_pr)

                                                        document.write(the_tot.toLocaleString())
                                                </script>
                                            </td>

                                            
                                        </tr>

                                        {% endfor %}

                                        <tr class="weight600 smallFont" >
                                            <td colspan="7" >
                                                {% if useri.langSet == 0 %}Jumla{% else %} Total{% endif %}
                                            </td>
                                            <td>{{exclude.tr | floatformat:'-2'  | intcomma}}</td>
                                          
                                            <td>{{exclude.trAmo| floatformat:'-2'  | intcomma}}</td>

                                        </tr>
                                    </tbody>
                                </table>


                        </div>

                         {% endif %}
            
                         {% if exclude.expf > 0 %}
                           <hr>
                         
                            <div class="table-responsive">
                                <strong>{% if useri.langSet == 0 %}Matumizi kwa Mafuta{% else %} Fuel  Usage & Wastage {% endif %}</strong>
                                <table class="table table-bordered smallFont table-sm">
                                    <thead>
                                        <tr class="smallFont" >
                                            <th>#</th>
                                            <th>{% if useri.langSet == 0 %}MudaTarehe{% else %}DateTime{% endif %}</th>

                                            <th>{% if useri.langSet == 0 %}Matumizi{% else %} Usage {% endif %} </th>
                                            <th>{% if useri.langSet == 0 %}Maelezo{% else %} Description{% endif %} </th>
                                            <th>{% if useri.langSet == 0 %}Pampu{% else %} Pump{% endif %} </th>
                                            <th>{% if useri.langSet == 0 %}Mafuta{% else %} Fuel{% endif %} </th>
                                            <th>{% if useri.langSet == 0 %}Bei{% else %} Price{% endif %} /<span class="text-primary">LTRS</span> </th>
                                           
                                            <th>{% if useri.langSet == 0 %}Kiasi{% else %} Qty{% endif %} <span class="text-primary">LTRS</span> </th>
                                            <th>{% if useri.langSet == 0 %}Thamani{% else %} Worth{% endif %} <span class="text-primary">{{currencii}}</span> </th>
                                            
                                            </tr>
                                    </thead>
                            
                                        <tbody>
                                            {% for s in expF %}
                                            
                                            <tr>
                                                <td>{{forloop.counter}}</td>
                                                <td>
                                                    <script>
                                                        document.write(moment('{{s.tarehe | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                                    </script>
                                                </td>
                                                <td class="brown">{{s.matumizi.matumizi | title}}</td>
                                                <td >{{s.maelezo}}</td>
                                                <td class="bluePrint" >{{s.fromShift.pump.station.name}} {{s.fromShift.pump.name}}</td>
                                                <td class="brown" >{{s.Fuel.name}}</td>
                                                <td>{{s.fuel_price|floatformat:'-2'|intcomma}}</td>
                                                <td>{{s.fuel_qty|floatformat:'-2'|intcomma}}</td>
                                                
                                                <td>{{s.kiasi|floatformat:'-2'|intcomma}}</td>

                                                <!-- <td>{{s.sa_price|floatformat:'-2'|intcomma}}</td>
                                                <td>{{s.amount|floatformat:'-2'|intcomma}}</td>
                                                <td>{{s.payed|floatformat:'-2'|intcomma}}</td> -->
                                            </tr>
                                        




                                            {% endfor %}

                                            <tr>
                                                <th colspan="7" >
                                                    {% if useri.langSet == 0 %}Jumla {% else %}Total  {% endif %}
                                                </th>
                                                <th>
                                                    {{exclude.expf | floatformat:'-2'  | intcomma}}
                                                
                                                </th>

                                                
                                                <th>
                                                    {{exclude.expfA | floatformat:'-2'  | intcomma}}
                                                </th>
                                            </tr>

                                        </tbody>
                                    </table>


                            </div>
                      
            
                         {% endif %}
            
                         {% if exclude.expamo > 0 %}
                           <hr>
                         <div class="table-responsive">
                            <strong>{% if useri.langSet == 0 %}Matumizi ya Pesa{% else %} Expenses By Cash{% endif %}</strong>
                            <table class="table table-bordered smallFont table-sm">
                                <thead>
                                    <tr class="smallFont" >
                                        <th>#</th>
                                        <th>{% if useri.langSet == 0 %}MudaTarehe{% else %}DateTime{% endif %}</th>
            
                                        <th>{% if useri.langSet == 0 %}Matumizi{% else %} Expanses {% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Maelezo{% else %} Description{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Kiasi{% else %} Amount{% endif %} <span class="text-primary">({{currencii}})</span> </th>
                                        
                                        </tr>
                                </thead>
                           
                                    <tbody>
                                        {% for s in expA %}
                                   
                                        <tr>
                                            <td>{{forloop.counter}}</td>
                                            <td>
                                                <script>
                                                    document.write(moment('{{s.tarehe | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                                </script>
                                            </td>
                                            <td class="brown">{{s.matumizi.matumizi | title}}</td>
                                            <td >{{s.maelezo}}</td>
            
                                            <td>{{s.kiasi|floatformat:'-2'|intcomma}}</td>
            
                                            <!-- <td>{{s.sa_price|floatformat:'-2'|intcomma}}</td>
                                            <td>{{s.amount|floatformat:'-2'|intcomma}}</td>
                                            <td>{{s.payed|floatformat:'-2'|intcomma}}</td> -->
                                        </tr>
                                       
            
                                        {% endfor %}
            
                                        <tr>
                                            <th colspan="4" >{% if useri.langSet == 0 %}Jumla {% else %}Total  {% endif %}</th>
                                             <th>{{exclude.expamo | floatformat:'-2'  | intcomma}}</th>
                                        </tr>
                                    </tbody>
                                  </table>
            
            
                         </div>
                      
                         {% endif %}
                         {% if exclude.cashBA > 0 %}
                           <hr>
                         <div class="table-responsive">
                            <strong>{% if useri.langSet == 0 %}Pesa Iliyotoka{% else %} Cash Deposit Before{% endif %}</strong>
                            <table class="table table-bordered smallFont table-sm">
                                <thead>
                                    <tr class="smallFont" >
                                        <th>#</th>
                                        <th>{% if useri.langSet == 0 %}MudaTarehe{% else %}DateTime{% endif %}</th>
            
                                        <th>{% if useri.langSet == 0 %}Akaunti{% else %}Account  {% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Aliyekabidhiwa{% else %} Given To{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Maelezo{% else %}Description{% endif %} </th>
                                        <th>{% if useri.langSet == 0 %}Kiasi{% else %} Amount{% endif %} <span class="text-primary">({{currencii}})</span> </th>
                                        
                                        </tr>
                                </thead>
                           
                                    <tbody>
                                      
                                        {% for cb in exclude.cashB %}
                                        
                                    
                                        <tr>
                                            <td>{{forloop.counter}}</td>
                                            <td>
                                                <script>
                                                    document.write(moment('{{cb.tarehe | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                                </script>
                                            </td>
                                            <td class="brown">{{cb.Akaunt.Akaunt_name | title}}</td>
                                            <td >{{cb.giveTo}}</td>
                                            <td >{{cb.maelezo}}</td>
            
                                            <td>{{cb.Amount|floatformat:'-2'|intcomma}}</td>
            
                                            <!-- <td>{{s.sa_price|floatformat:'-2'|intcomma}}</td>
                                            <td>{{s.amount|floatformat:'-2'|intcomma}}</td>
                                            <td>{{s.payed|floatformat:'-2'|intcomma}}</td> -->
                                        </tr>
                                        
            
                                        {% endfor %}
            
                                        <tr>
                                            <th colspan="5" >{% if useri.langSet == 0 %}Jumla {% else %}Total  {% endif %}</th>
                                             <th>{{exclude.cashBA | floatformat:'-2'  | intcomma}}</th>
                                        </tr>
                                    </tbody>
                                  </table>
            
            
                         </div>
                      
                         {% endif %}
            
                        </div>
            
                        <hr>
                         
                            <div class="row">
                                <div class="col-7">
                                                    <strong>{% if useri.langSet == 0 %}Ufupisho wa Zamu{% else %}Shift Summary Report {% endif %}</strong>
            
                                </div>
                                <div class="col-5 smallFont text-right">
                                      <!-- <a type="button" onclick="$('#Shiftdetails').toggle(500)" href="#" >
                                           {% if useri.langSet == 0 %}Maelezo ya Kina{% else %}Shift Details  {% endif %}
                                       
                                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-up">
                                            <polyline points="17 11 12 6 7 11"></polyline><polyline points="17 18 12 13 7 18"></polyline></svg>
                                    </a> -->
                                </div>
                            </div>

                            <div class="table-responsive">
                            
                            <table class="table table-bordered smallFont table-sm">
                                <thead>
                                    <tr class="smallFont" >
                                      
                                        <td class="pl-1">{% if useri.langSet == 0 %}Jumla{% else %}Total{% endif %}</td>
            
                                       
                                        <td class="pl-1">{% if useri.langSet == 0 %}Kiasi{% else %} Qty{% endif %} <span class="text-primary">LTRS</span> </td>
                                        <td class="pl-1">{% if useri.langSet == 0 %}Kiasi{% else %} Amount{% endif %} <span class="text-primary">({{currencii}})</span> </td>
                                      </tr>
                                </thead>
                           
                                     <tbody>  
                                      
                                        <tr  class="grey"  >
                                           
                                            <th style="font-size: 15px;"> {% if useri.langSet == 0 %}Mafuta yaliyotoka{% else %} Fuel Flow{% endif %}</th>
                                            <th style="font-size: 15px;" id="tot_ltr" >{{calcA.shQ|floatformat:'-2'|intcomma}}</th>
                                            <th style="font-size: 15px;" id="tot_amo" >{{calcA.shA|floatformat:'-2'|intcomma}}</th>
                                        </tr>
                                        
                                         {% if exclude.sale > 0 %} 
                                        <tr >
                                            <td style="font-size: 15px;"> {% if useri.langSet == 0 %}Mauzo Wateja Maalum{% else %} Credit Oder Sales{% endif %}</td>
                                            <td style="font-size: 15px;"  >{{exclude.sale|floatformat:'-2'|intcomma}}</td>
                                            <td style="font-size: 15px;"  >{{exclude.saleA|floatformat:'-2'|intcomma}}</td>
                                        </tr>
                                        {% endif %}
            
                                        {% if exclude.tr > 0  %}
                                        <tr >
                                           
                                            <td style="font-size: 15px;"> {% if useri.langSet == 0 %}Mafuta yaliyosafirishwa{% else %} Transfered Fuel{% endif %}</td>
                                            <td style="font-size: 15px;"  >{{exclude.tr|floatformat:'-2'|intcomma}}</td>
                                            <td style="font-size: 15px;"  >{{exclude.trAmo|floatformat:'-2'|intcomma}}</td>
                                        </tr>
                                        {% endif %}
               
                                        {% if exclude.expf > 0  %}
                                        <tr >
                                           
                                            <td style="font-size: 15px;"> {% if useri.langSet == 0 %}Mafuta Yaliyotumika{% else %} Fuel Usage{% endif %}</td>
                                            <td style="font-size: 15px;"  >{{exclude.expf|floatformat:'-2'|intcomma}}</td>
                                            <td style="font-size: 15px;"  >{{exclude.expfA|floatformat:'-2'|intcomma}}</td>
                                        </tr>
                                        {% endif %}
            
                                        {% if exp or trd or sale %}
                                            <tr class="grey"  >
                                            
                                                <th style="font-size: 15px;"> {% if useri.langSet == 0 %}Mauzo ya Pampu{% else %} Pump Sales{% endif %}</th>
                                                <th style="font-size: 15px;"  id="pump_sales_qty" >{{calcA.PmpSQ|floatformat:'-2'|intcomma}}</th>
                                                <th style="font-size: 15px;" id="pump_sales_amo"  >{{calcA.PmpSA|floatformat:'-2'|intcomma}}</th>
                                            </tr>
                                        {% endif %}
            
                                        {% if exclude.expamo > 0 %}
                                        <tr >
                                           
                                            <td style="font-size: 15px;"> {% if useri.langSet == 0 %}Matumizi ya Pesa{% else %}Expenses by Cash{% endif %}</td>
                                            <td style="font-size: 15px;"  ></td>
                                            <td style="font-size: 15px;"  >{{exclude.expamo|floatformat:'-2'|intcomma}}</td>
                                        </tr>
                                        {% endif %}
            
                                        {% if exclude.cashB %}
                                        <tr >
                                           
                                            <td style="font-size: 15px;"> {% if useri.langSet == 0 %}Pesa Iliyotoka{% else %}Cash Out Before{% endif %}</td>
                                            <td style="font-size: 15px;"  ></td>
                                            <td style="font-size: 15px;"  >{{exclude.cashBA|floatformat:'-2'|intcomma}}</td>
                                        </tr>
            
                                        {% endif %}
            
                                      
                                      
                                        <tr class="grey" >
                                           
                                            <th style="font-size: 15px;"> {% if useri.langSet == 0 %}Pesa Inayotakiwa {% else %}Net Required Amount{% endif %}</td>
                                            <th style="font-size: 15px;"  ></th>
                                            <th style="font-size: 15px;" data-net=0 id="net_required"  >{{trf.amount|floatformat:'-2'|intcomma}}</th>
                                        </tr>

                                        <tr class="grey" >
                                           
                                            <th style="font-size: 15px;"> {% if useri.langSet == 0 %}Pesa Iliyolipwa {% else %}Paid Amount{% endif %}</td>
                                            <th style="font-size: 15px;"  ></th>
                                            <th style="font-size: 15px;" data-net=0 id="net_required"  >{{trf.paid|floatformat:'-2'|intcomma}}</th>
                                        </tr>
                                        {% if trf.amount > trf.paid %}
                                        <tr class="grey brown" >
                                           
                                            <th style="font-size: 15px;"> {% if useri.langSet == 0 %}Hasara {% else %}Loss{% endif %}</td>
                                            <th style="font-size: 15px;"  ></th>
                                            <th style="font-size: 15px;" data-net=0 id="net_required"  >{{calcA.lossProf|floatformat:'-2'|intcomma}}</th>
                                        </tr>
                                        {% endif %}

                                        {% if trf.amount < trf.paid %}
                                        <tr class="grey green" >
                                           
                                            <th style="font-size: 15px;"> {% if useri.langSet == 0 %}Bonusi{% else %}Bonus{% endif %}</td>
                                            <th style="font-size: 15px;"  ></th>
                                            <th style="font-size: 15px;" data-net=0 id="net_required"  >{{calcA.lossProf|floatformat:'-2'|intcomma}}</th>
                                        </tr>
                                        {% endif %}

                                        {% if trf.amount == trf.paid %}
                                        <tr class="grey" >
                                           
                                            <th style="font-size: 15px;"> {% if useri.langSet == 0 %}Bonusi/Hasara {% else %}Bonus/Loss{% endif %}</td>
                                            <th style="font-size: 15px;"  ></th>
                                            <th style="font-size: 15px;" data-net=0 id="net_required"  >{{calcA.lossProf|floatformat:'-2'|intcomma}}</th>
                                        </tr>
                                        {% endif %}
            
                                    
                                     </tbody>
                                     </table>
                         </div>
                  

                     <hr>
                      <div><strong>{% if useri.langSet == 0 %}Viambatanisho{% else %}Attachments{% endif %}:</strong></div>
                      {% if attach%}
                      <ul class="list-unstyled" >

                         {% for at in attach %}
                           <li>
                               <a href="{{at.file.url}}" target="_blank" >
                                   <div class="d-flex" >
                                       <div class="p-2">
                                        <span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="1.6em" height="1.6em" fill="currentColor" class="bi bi-paperclip" viewBox="0 0 16 16">
                                              <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
                                          </svg>
                                        </span>
                                          
                                       </div>

                                       <div>
                                           
                                            <small class="d-block" >date: 

                                              <script>
                                                document.write(moment('{{at.date | date:"r" }}').format('DD/MM/YYYY HH:mm '))
                                            </script> 
                                            | {% if at.printedDocu %} {% if useri.langSet == 0 %}Dokument iliyoprintiwa na kusainiwa {% else %}Printed and signed document{% endif %} {% else %} {{at.attach_name}} {%endif%}
                                            </small>

                                            <small class="d-block" >
                                                By: {{at.by.user.first_name|title}} {{at.by.user.last_name|title}}
 
                                            </small>
                                           
                                       </div>

                                   </div>
                               </a>
                           </li>
                          {% endfor %} 
                       </ul> 

                       {% else %}
                            <p class="btn-sm" >{% if useri.langSet == 0 %}Hakuna Viambatanisho{% else %}No Attachments{% endif %} </p>  
                       {% endif %}



                    </div>
                </div>    


        </div>



   </div>              
              
    </div>

</div>

    

    <!-- Modal Attachments -->
    <div class="modal fade" id="addAttachment" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
      <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              {% if useri.langSet == 0 %}Kiambatanisho{% else %}Attachment {%endif%}
            </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
            <form id="attachform" action="/salepurchase/addAttach" method="post">
                 {% csrf_token %}
              <div class="classic_div text-center">
                    <label type="button" class="btn btn-light" for="attachment">
                      <svg xmlns="http://www.w3.org/2000/svg" width="3.3em" height="3.3em" fill="currentColor" class="bi bi-paperclip" viewBox="0 0 16 16">
                        <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
                    </svg>
                      <div class="text-center">
                         <small id="attach_name" > 
                          
                          {% if useri.langSet == 0 %}Bonyeza Kuongeza{% else %}Press to Add{% endif %}
                        </small> 
                      </div>
                    </label>
                    <input type="file" name="attachment" onchange="
                      const val = $(this).val();
                       $('#submitattach').prop('disabled',val=='');
                       $('#attach_name').html(val)

                    " accept=".pdf" hidden id="attachment">
                    <input type="hidden" name="sh" value="{{trf.id}}" >
                </div>

                <div class="form-group mt-3">
                    <label for="attach_name" class="brown"  >{% if useri.langSet == 0 %}Jina la Kiambatanisho{% else %}Attachment Name{%endif%} <sup>*</sup> </label>
                    <input type="text"
                      class="form-control btn-sm" name="attach_name" id="attach_name" aria-describedby="helpId" placeholder="">
                    
                      <div class="custom-control custom-checkbox">
                       <input type="checkbox" class="custom-control-input" 
                        onchange="$('#printedDoc').val(Number($(this).prop('checked')))"
                       name="printedDocIn"
                       id="printedDocIn">
                      
                       
                       <label class="custom-control-label latoFont smallFont cursor-pointer" style="cursor: pointer !important;" for="printedDocIn">
                          <small>{% if useri.langSet == 0 %}Dokumenti iliyoprintiwa na kusainiwa{% else %}Printed and signed document{% endif %}</small>
                       </label>
                       </div>
                       <input type="hidden" value=0 id="printedDoc" name="printedDoc">
                  </div>

                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" id="submitattach" disabled class="btn btn-primary">
                      <svg xmlns="http://www.w3.org/2000/svg" width="1.3em" height="1.3em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-upload">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                    </button>
                  </div>
            </form>

          </div>

        </div>
      </div>
    </div>






{% endblock %}

{% block additionaljs %}
<script>

     $('body').on("submit", "#savepaymentForm" ,function(e){
                    e.preventDefault();
                    const invo = Number('{{trf.id}}'),
                          url = $(this).attr("action"),
                          ac = Number($('#malipo-akaunti').val()),
                          pay_amo = Number($('#lipa_kiasi').val())||Number('{{baki}}'),
                          date = $('#pay_d').val(),
                          amo = Number('{{baki}}'),
                          desc = $('#lipaElezo').val()
                          data = {
                            data:{
                              invo,
                              ac,
                              pay_amo,
                              date,
                              desc
                            },
                            url
                          }

                          if(ac&&pay_amo<=amo){
                                    $("#modal_malipo").modal('hide');
                                    $("#loadMe").modal('show');
                                    const sendIt = POSTREQUEST(data)
                                    sendIt.then(resp=>{
                                      $('#loadMe').modal('hide')
                                            hideLoading()
                                            const msg = lang(resp.msg_swa,resp.msg_eng)
                                            if(resp.success){
                                            toastr.success(msg, lang('Imefanikiwa','Success '), {timeOut: 2000});
                                            // location.replace(`/salepurchase/viewShift?i=${resp.id}`)
                                               location.reload()
                                          }else{
                                              toastr.error(msg, lang('Haikufanikiwa','Error '), {timeOut: 2000});
                                        
                                          }


                                    })
                          }

                  
                })
  



</script>

{% endblock %}

{% block shifts %} active {% endblock %}